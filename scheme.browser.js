;(function () {var _module = {},_require = function (x) { return _module[x].exports },process = {};(function (require, module) {'use strict';var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }var T_NULL = Symbol('t_null');var T_EXPR = Symbol('t_expr');var T_VARI = Symbol('t_vari');var T_NUMB = Symbol('t_numb');var T_STRI = Symbol('t_stri');var T_BOOL = Symbol('t_bool');var Tokenizer = function Tokenizer(raw) {_classCallCheck(this, Tokenizer);var str = raw.replace(/\n/g, ' ').trim();var type = T_NULL;var args = [];switch (true) {case !str.length:type = T_NULL;break;case /^null$/.test(str):type = T_NULL;break;case /^\-?(\d+|\d+\.\d*|\d*\.\d+)$/.test(str):type = T_NUMB;break;case /^(true|false)$/.test(str):type = T_BOOL;break;case /^[a-zA-Z_\+\-\*/<>=\[\]]+[0-9a-zA-Z_\+\-\*/<>=\[\]]*$/.test(str):type = T_VARI;break;case /^"(\\"|[^"])*"$/.test(str):type = T_STRI;break;case /^\(.+\)$/.test(str):type = T_EXPR;var flag = 0,_escape = false,remain = '';for (var i = 1; i < str.length - 1; ++i) {if (_escape) {_escape = false;} else {var ch = str[i];switch (ch) {case '\\':_escape = true;remain += ch;break;case '(':flag += 2;remain += ch;break;case ')':flag -= 2;remain += ch;break;case '\"':flag ^= 1;remain += ch;break;case ' ':case '\n':case '\t':if (!flag) {if (remain) {args.push(remain);}remain = '';} else {remain += ch;}break;default:remain += ch;}}}args.push(remain);break;}this.str = str;this.type = type;this.args = args;};var Scope = function () {function Scope() {var scope = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];var parent = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];_classCallCheck(this, Scope);this.scope = scope;this.parent = parent;}_createClass(Scope, [{key: 'eval',value: function _eval(token) {if (token.constructor != Tokenizer) {token = new Tokenizer(token);}var _token = token;var type = _token.type;var str = _token.str;var args = _token.args;switch (type) {case T_NULL:return null;case T_NUMB:return Number(str);case T_BOOL:return str === 'true';case T_STRI:return str.slice(1, -1);case T_VARI:var v = this.scope[str];if (typeof v === 'undefined') {return this.parent.eval(str);}if (typeof v === 'string') {if (this.parent) {return this.parent.eval(v);}return this.eval(v);}return v;case T_EXPR:var fnToken = new Tokenizer(args[0]);if (fnToken.type === T_VARI) {var fn = this.scope[args[0]];if (typeof fn === 'undefined') {return this.parent.eval(args[0]).apply(this, args.slice(1));}}return this.eval(args[0]).apply(this, args.slice(1));}}}]);return Scope;}();module.exports = {Tokenizer: Tokenizer,Scope: Scope,T_NULL: T_NULL,T_EXPR: T_EXPR,T_VARI: T_VARI,T_NUMB: T_NUMB,T_STRI: T_STRI,T_BOOL: T_BOOL};})(_require, _module['./core'] = {});(function (require, module) {'use strict';var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }var _require = require('./core');var Tokenizer = _require.Tokenizer;var Scope = _require.Scope;var T_VARI = _require.T_VARI;var T_EXPR = _require.T_EXPR;var T_BOOL = _require.T_BOOL;var T_NULL = _require.T_NULL;var T_NUMB = _require.T_NUMB;var T_STRI = _require.T_STRI;var define = function define(s_a, s_b) {var scope = this.scope; var a = new Tokenizer(s_a);if (a.type === T_VARI) {var newScope = Object.assign({}, this.scope, _defineProperty({}, a.str, s_b));return new Scope(newScope, this);} else if (a.type === T_EXPR) {var _newScope = Object.assign({}, this.scope);_newScope[a.args[0]] = function () {var innerScope = Object.assign({}, this.scope);for (var i = 1; i < a.args.length; ++i) {innerScope[a.args[i]] = arguments.length <= i - 1 + 0 ? undefined : arguments[i - 1 + 0]; }return new Scope(innerScope, this).eval(s_b);};return new Scope(_newScope, this);}};var lambda = function lambda(s_a, s_b) {var scope = Object.assign({}, this.scope);var a = new Tokenizer(s_a);return function () {var innerScope = Object.assign({}, scope, this.scope);for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}if (a.type === T_EXPR) {for (var i = 0; i < a.args.length; ++i) {innerScope[a.args[i]] = args[i];}} else if (a.type === T_VARI) {innerScope[a.str] = args[0];}return new Scope(innerScope, this).eval(s_b);};};var defaults = {define: define,lambda: lambda,'+': function _(a, b) {return this.eval(a) + this.eval(b);},'-': function _(a, b) {return this.eval(a) - this.eval(b);},'*': function _(a, b) {return this.eval(a) * this.eval(b);},'/': function _(a, b) {return this.eval(a) / this.eval(b);},'>': function _(a, b) {return this.eval(a) > this.eval(b);},'<': function _(a, b) {return this.eval(a) < this.eval(b);},'=': function _(a, b) {return this.eval(a) === this.eval(b);},cond: function cond() {for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {args[_key2] = arguments[_key2];}for (var i = 0; i < args.length; ++i) {var _args = _slicedToArray(new Tokenizer(args[i]).args, 2);var condition = _args[0];var value = _args[1];if (this.eval(condition) === true) {return this.eval(value);}}return null;},list: function list() {var _this = this;for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {args[_key3] = arguments[_key3];}return [].concat(_toConsumableArray(args.map(function (arg) {return _this.eval(arg);})), [null]);},car: function car(list) {return this.eval(list)[0];},cdr: function cdr(list) {return this.eval(list).slice(1);},prepend: function prepend(value, list) {return [this.eval(value)].concat(_toConsumableArray(this.eval(list)));},debug: function debug(x) {console.log(x);return this.eval(x);}};module.exports = {rootScope: new Scope(defaults),Scope: Scope,defaults: defaults};})(_require, _module['./default'] = {});(function (require, module) {'use strict';var _require = require('./core');var Tokenizer = _require.Tokenizer;var Scope = _require.Scope;var T_VARI = _require.T_VARI;var T_EXPR = _require.T_EXPR;var T_BOOL = _require.T_BOOL;var T_NULL = _require.T_NULL;var T_NUMB = _require.T_NUMB;var T_STRI = _require.T_STRI;var _require2 = require('./default');var defaults = _require2.defaults;var rootScope = new Scope(Object.assign(defaults, {/* define */}));var t = new Scope({}, rootScope);function repl(str) {var res = t.eval(str);if (res.constructor === Scope) {t = res;res = '';}return res.toString();}if (process && process.argv0 === 'node') {process.stdout.write('> ');process.stdin.on('data', function (str) {console.log(repl(Buffer(str).toString()));process.stdout.write('> ');});} else {window.repl = repl;}})(_require, _module['./repl'] = {})})()